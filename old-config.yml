# Acoustic Multiclass Training config file

# Required path related config
dataframe_csv: "/share/acoustic_species_id/132PeruXC_TweetyNetLabels_baseline.csv"
data_path: "/share/acoustic_species_id/132_peru_xc_BC_2020/"

# Dataframe column names
offset_col: "OFFSET"
duration_col: "DURATION"
file_name_col: "IN FILE"
manual_id_col: "SPECIES"

# Device Settings
device: auto # Options: cuda, cpu, auto 
prepros_device: cpu # Options: cuda, CPU

#chunking settings
is_unchunked: True
does_center_chunking: False
chunk_length_s: 5
min_length_s: 0.4
include_last: false
overlap: 0.5

# Training params
train_batch_size: ls

validation_batch_size: 32
jobs: 4
valid_freq: 1000
mixed_precision: true
valid_dataset_ratio: 0.3
does_weighted_sampling: False

# Logging
logging: true
logging_freq: 20 # Batches per log
wandb_entity: "acoustic-species-identification"
wandb_project: "acoustic-species-reu2023-sweeps"
wandb_run_name: "auto"
debug: false

# Functional settings
seed: 0
sample_rate: 32_000
map_debug: false
train_test_split: 0.8
num_fold: 5

# Model hyperparameters
# Specifies default model architecture from timm library
# Options:
#     eca_nfnet_l0 (90 MB)
#     tf_efficientnet_b4 (70 MB)
#     convnext_nano (60 MB)
#     convnext_tiny (110 MB)
#     resnetv2_50 (100 MB)
#     resnetv2_101 (170 MB)
#     seresnext50_32x4d (100 MB)
#     seresnext101_32x4d (200 MB)
#     rexnet_200 (70 MB)
#     mobilenetv3_large_100_miil_in21k (70 MB)
model: "eca_nfnet_l0"
epochs: 10
learning_rate: 0.001
# Loss function options:
#   CE: Cross entropy
#   BCE: Binary cross entropy
#   BCEWL: Binary cross entropy with logits
loss_fnc: "CE"
imb: false

# Hyperparameter sweep settings
sweep_id: 

# Specify path to load a checkpoint
model_checkpoint: ""

# Patience
early_stopping: false
patience: 3
min_valid_map_delta: 0.01

# Data augmentation probabilities
mixup_p: 0
time_shift_p: 0
noise_p: 0.23
freq_mask_p: 0.5
time_mask_p: 0.11
rand_eq_p: 0
noise_p: 23
lowpass_p: 0.05
highpass_p: 0.02
bg_noise_p: 0

# Data augmentation parameters
noise_type: "violet"
noise_alpha: 0.06
freq_mask_param: 10 # Number of frequencies masked
time_mask_param: 38 # Number of samples masked
mixup_alpha_range: [0.0, 0.6]
rand_eq_f_range: [20, 8000]
rand_eq_q_range: [0.3, 3]
rand_eq_g_range: [-2, 8]
rand_eq_iters: 2
lowpass_cutoff: 7000
lowpass_q_val: 0.44
highpass_cutoff: 1000
highpass_q_val: 0.44
bg_noise_alpha_range: [0.0, 0.4]

# Background noise params
# Expects background_path to lead to a directory with only audio files
# Example dataset: BirdVOX at https://dcase.community/challenge2018/task-bird-audio-detection
# Make sure to delete all bird clips so it is only background noise
# If path is blank and p=0, background noise will not be used
bg_noise_path: ""

# Transforms settings
imbalance_sampler: false
pos_weight: 1
smoothing: 0.05

# FFT Settings
hop_length: 512
n_mels: 194
n_fft: 1400
max_time: 5
